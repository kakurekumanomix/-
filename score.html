<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>点数表示</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .score { margin: 20px; font-size: 2em; }
        .payment { margin-top: 20px; }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        let scores = [25000, 25000, 25000, 25000]; // 初期点数
        let selectedSeat = null;

        window.onload = function() {
            const players = JSON.parse(localStorage.getItem('players'));
            selectedSeat = localStorage.getItem('selectedSeat');
            document.getElementById('self').textContent = players[selectedSeat - 1] + ": " + scores[selectedSeat - 1];

            for (let i = 0; i < 4; i++) {
                if (i !== selectedSeat - 1) {
                    document.getElementById(`player${i + 1}`).textContent = players[i] + ": " + scores[i];
                }
            }

            // Firebaseから点数を取得し、リスナーを設定
            const scoresRef = firebase.database().ref('scores');
            scoresRef.on('value', (snapshot) => {
                scores = snapshot.val() || scores;
                updateScores();
            });
        };

        function pay() {
            const amount = parseInt(document.getElementById('amount').value);
            const recipient = parseInt(document.getElementById('recipient').value);
            
            if (!isNaN(amount) && amount > 0) {
                scores[selectedSeat - 1] -= amount;  // 自分の点数から減らす
                scores[recipient] += amount;  // 相手の点数に加える
                
                // Firebaseに点数を更新
                firebase.database().ref('scores').set(scores);
            } else {
                alert('正しい点数を入力してください');
            }
        }

        function updateScores() {
            const players = JSON.parse(localStorage.getItem('players'));
            for (let i = 0; i < 4; i++) {
                document.getElementById(`player${i + 1}`).textContent = players[i] + ": " + scores[i];
            }
            document.getElementById('self').textContent = players[selectedSeat - 1] + ": " + scores[selectedSeat - 1];
        }
    </script>
</head>
<body>
    <h1>点数表示</h1>
    <div>
        <div class="score" id="self">自分の点数</div>
        <div class="score" id="player1">プレイヤー1の点数</div>
        <div class="score" id="player2">プレイヤー2の点数</div>
        <div class="score" id="player3">プレイヤー3の点数</div>
    </div>
    <div class="payment">
        <h2>点数を支払う</h2>
        <label for="recipient">支払先:</label>
        <select id="recipient">
            <option value="0">プレイヤー1</option>
            <option value="1">プレイヤー2</option>
            <option value="2">プレイヤー3</option>
            <option value="3">自分</option>
        </select>
        <label for="amount">点数:</label>
        <input type="number" id="amount" placeholder="点数を入力">
        <button onclick="pay()">支払う</button>
    </div>
</body>
</html>
